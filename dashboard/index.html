<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Multi-Agent IoT POC</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1, h2 { color: #0056b3; }
        div { margin-bottom: 10px; }
        strong { color: #007bff; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Multi-Agent IoT POC Dashboard</h1>

        <h2>IoT Agent Data (Simulated)</h2>
        <div id="iot-data">Loading...</div>

        <h2>Weather Agent Data</h2>
        <div id="weather-data">Loading...</div>
    </div>

    <script>
        const API_GATEWAY_URL = "http://localhost:8000"; // Accessible from browser

        async function fetchData() {
            try {
                const response = await fetch(`${API_GATEWAY_URL}/data/latest`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Display IoT Data
                const iotDiv = document.getElementById('iot-data');
                if (data.iot_data && data.iot_data.temperature !== null) {
                    iotDiv.innerHTML = `
                        <div><strong>Temperature:</strong> ${data.iot_data.temperature}Â°C</div>
                        <div><strong>Humidity:</strong> ${data.iot_data.humidity}%</div>
                        <div><strong>Timestamp:</strong> ${new Date(data.iot_data.timestamp).toLocaleString()}</div>
                    `;
                } else {
                    iotDiv.innerHTML = `<div class="error">No IoT data available yet.</div>`;
                }

                // Display Weather Data
                const weatherDiv = document.getElementById('weather-data');
                if (data.weather_summary && !data.weather_summary.error) {
                    weatherDiv.innerHTML = `
                        <div><strong>City:</strong> ${data.weather_summary.city}</div>
                        <div><strong>Summary:</strong> ${data.weather_summary.summary}</div>
                    `;
                } else {
                    weatherDiv.innerHTML = `<div class="error">${data.weather_summary.error || 'No weather data available yet.'}</div>`;
                }

            } catch (error) {
                console.error("Error fetching data:", error);
                document.getElementById('iot-data').innerHTML = `<div class="error">Error fetching IoT data: ${error.message}</div>`;
                document.getElementById('weather-data').innerHTML = `<div class="error">Error fetching Weather data: ${error.message}</div>`;
            }
        }

        // Fetch data initially and then every 5 seconds
        fetchData();
        setInterval(fetchData, 5000);
    </script>
</body>
</html>